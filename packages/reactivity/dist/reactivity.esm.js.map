{
  "version": 3,
  "sources": ["../../shared/src/general.ts", "../src/dep.ts", "../src/effect.ts", "../src/baseHandlers.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts"],
  "sourcesContent": ["export const isObject = (val: unknown): val is Record<any, any> => val !== null && typeof val === 'object';\n\nexport const hasChanged = (value: any, oldValue: any): boolean => !Object.is(value, oldValue);\n\nexport const isFunction = (val: unknown): val is Function => typeof val === 'function';\n\nexport const NOOP = () => {};\n\nexport const isArray = Array.isArray;\n\nexport const objectToString = Object.prototype.toString;\nexport const toTypeString = (value: unknown): string => objectToString.call(value);\n\nexport const isPlainObject = (val: unknown): val is object => toTypeString(val) === '[object Object]';\n", "import { ReactiveEffect } from './effect';\n\nexport type Dep = Set<ReactiveEffect>;\n\nexport const createDep = (effects?: ReactiveEffect[]): Dep => {\n\tconst dep = new Set<ReactiveEffect>(effects) as Dep;\n\treturn dep;\n};\n", "import { isArray } from '@vue/shared';\nimport { Dep, createDep } from './dep';\n\n// \u5168\u5C40\u7684effect\nexport let activeEffect: ReactiveEffect | undefined;\n\n//  weakMap = {\n// \t \t\ttarget: {\n// \t \t\t\tkey: Set<ReactiveEffect, ReactiveEffect, ReactiveEffect>\n// \t \t\t}\n// \t }\nconst targetMap = new WeakMap<any, Map<any, Dep>>();\n\nexport type EffectScheduler = (...args: any[]) => any;\n\nexport interface ReactiveEffectRunner<T = any> {\n\t(): T;\n\teffect: ReactiveEffect;\n}\n\nexport interface ReactiveEffectOptions {\n\tscheduler?: EffectScheduler;\n}\n\n// \u57FA\u7C7B\uFF1A\u4F5C\u4E3A\u54CD\u5E94\u5F0F\u7CFB\u7EDF\u7684\u6700\u5E95\u5C42\u7684\u63D0\u4F9B\u8005\uFF0Ccomputed\u3001watch\u90FD\u662F\u57FA\u4E8EReactiveEffect\u6765\u505A\uFF0C\u5185\u90E8\u4FDD\u5B58\u7740\u5F53\u524D\u6536\u96C6\u4F9D\u8D56\u7684\u91CD\u8981\u5C5E\u6027deps\n// \u6838\u5FC3\u65B9\u6CD5\uFF1Arun\uFF0C\u8BB0\u5F55\u5F53\u524D\u7684activeEffect\uFF0C\u8868\u660Eproxy\u5BF9\u8C61get\u65B9\u6CD5\u662F\u5426\u662F\u5728effect\u4E2D\uFF0C\u662F\u5C31\u4F1A\u89E6\u53D1\u4F9D\u8D56\u6536\u96C6\u3002\nexport class ReactiveEffect<T = any> {\n\t// \u6807\u8BB0\u5F53\u524Deffect\u662F\u5426\u662F\u6FC0\u6D3B\u72B6\u6001\uFF0C\u5982\u679C\u662F\u6FC0\u6D3B\u72B6\u6001\uFF0C\u4F1A\u89E6\u53D1\u4F9D\u8D56\u6536\u96C6\n\tactive = true;\n\t// \u6536\u96C6\u5F53\u524D\u6FC0\u6D3B\u7684activeEffect\n\tdeps: Dep[] = [];\n\t// \u6807\u8BB0\u5F53\u524D\u7684effect\n\t/**\n\t * effect(() => {\n\t * \tthis.name e1\n\t * \t effect(() => {\n\t * \t\t\tthis.name  e2\n\t * \t })\n\t * \t this.name  \u8FD9\u91CC\u5FC5\u987B\u662F e1\n\t * })\n\t *\n\t * \u7B2C\u4E00\u4E2Aeffect\u6267\u884C\n\t * parent -> activeEffect -> this\n\t * \u51FD\u6570\u6267\u884C\u5B8C\u6210\n\t * activeEffect = this.parent\n\t * parent = undefined\n\t *\n\t * \u7B2C\u4E8C\u4E2Aeffect\u6267\u884C\n\t * parent -> activeEffect\n\t *\n\t * e1 -> e2 -> e1\n\t */\n\tparent: ReactiveEffect | undefined = undefined;\n\t// scheduler\u8BB0\u5F55\u7740\uFF1Aproxy\u5BF9\u8C61set\u4E86\u65B0\u7684\u503C\uFF0C\u4F1A\u89E6\u53D1scheduler\u56DE\u8C03\n\t// \u8FD9\u91CC\u4E5F\u53EF\u4EE5\u8BA4\u4E3A\u662F proxy\u5BF9\u8C61\u7684\u5C5E\u6027\u53D1\u751F\u4E86\u53D8\u5316\n\n\tconstructor(public fn: () => T, public scheduler: EffectScheduler | null = null) {}\n\n\trun() {\n\t\t// \u5982\u679C\u4E0D\u662F\u6FC0\u6D3B\u6001\uFF0C\u76F4\u63A5\u8FD4\u56DE\u56DE\u8C03\u51FD\u6570\u6267\u884C\u7ED3\u679C\n\t\tif (!this.active) {\n\t\t\treturn this.fn();\n\t\t}\n\n\t\ttry {\n\t\t\tthis.parent = activeEffect;\n\t\t\tactiveEffect = this;\n\n\t\t\t// \u6267\u884C\u4F9D\u8D56\u56DE\u8C03\u4E4B\u524D\uFF0C\u5148\u6E05\u7A7A\u6536\u96C6\u7684effects\n\t\t\tcleanupEffect(this);\n\t\t\treturn this.fn();\n\t\t} finally {\n\t\t\t// e1\n\t\t\tactiveEffect = this.parent;\n\t\t\tthis.parent = undefined;\n\t\t}\n\t}\n\n\tstop() {\n\t\tif (this.active) {\n\t\t\tcleanupEffect(this);\n\t\t\tthis.active = false;\n\t\t}\n\t}\n}\n\nexport function effect<T = any>(fn: () => T, options?: ReactiveEffectOptions) {\n\tconst _effect = new ReactiveEffect(fn, options?.scheduler);\n\n\tif (!options) {\n\t\t_effect.run();\n\t}\n\n\tconst runner = _effect.run.bind(_effect) as ReactiveEffectRunner;\n\trunner.effect = _effect;\n\treturn runner;\n}\n\nexport function stop(runner: ReactiveEffectRunner) {\n\trunner.effect.stop();\n}\n\n/**\n * \u6536\u96C6\u4F9D\u8D56\n * \u6536\u96C6\u6570\u636E\u683C\u5F0F\u5982\u4E0B\uFF1A\n * weakMap = {\n * \t\ttarget: {\n * \t\t\tkey: Set<ReactiveEffect, ReactiveEffect, ReactiveEffect>\n * \t\t}\n * }\n *\n * \u56E0\u4E3A\u4E00\u4E2A\u53D6\u503C\u64CD\u4F5C\u53EF\u4EE5\u53D1\u751F\u5728\u591A\u4E2Aeffect\u4E2D\uFF0C\u6240\u4EE5Set\u91CC\u9762\u4F1A\u6709\u591A\u4E2AReactiveEffect\n *\n * @param target\n * @param key\n */\nexport function track(target: object, key: unknown) {\n\tif (activeEffect) {\n\t\t// \u8BF4\u660E\u5F53\u524D\u53D6\u503C\u64CD\u4F5C\u53D1\u751F\u5728effect\u4E2D\n\t\tlet depsMap = targetMap.get(target);\n\t\tif (!depsMap) {\n\t\t\t// \u4E0D\u5B58\u5728\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7A7Amap\n\t\t\ttargetMap.set(target, (depsMap = new Map()));\n\t\t}\n\t\tlet dep = depsMap.get(key);\n\t\tif (!dep) {\n\t\t\tdepsMap.set(key, (dep = new Set<ReactiveEffect>()));\n\t\t}\n\t\ttrackEffects(dep);\n\t}\n}\n\nexport function trackEffects(dep: Dep) {\n\tlet shouldTrack = !dep.has(activeEffect);\n\tif (shouldTrack) {\n\t\t// \u5982\u679CSet\u4E2D\u6CA1\u6709\u5F53\u524D\u6FC0\u6D3B\u7684activeEffect\uFF0C\u9700\u8981\u505A\u6536\u96C6\n\t\tdep.add(activeEffect);\n\t\tactiveEffect.deps.push(dep);\n\t}\n}\n\n/**\n * \u89E6\u53D1\u4F9D\u8D56\u66F4\u65B0\n * @param target\n * @param key\n * @param newValue\n * @param oldValue\n */\nexport function trigger(target: object, key: unknown, newValue: unknown, oldValue: unknown) {\n\tconst depsMap = targetMap.get(target);\n\t// \u6CA1\u6709\u6536\u96C6\u8BE5\u5BF9\u8C61\n\tif (!depsMap) {\n\t\treturn;\n\t}\n\n\tlet deps: (Dep | undefined)[] = [];\n\tif (key !== undefined) {\n\t\tdeps.push(depsMap.get(key));\n\t}\n\n\t// copy\u4E00\u4EFDdeps\uFF0C\u6E05\u7406\u4F9D\u8D56\u65F6\u5019\uFF0C\u9632\u6B62\u6B7B\u5FAA\u73AF\n\tconst effects: ReactiveEffect[] = [];\n\tfor (const dep of deps) {\n\t\tif (dep) {\n\t\t\teffects.push(...dep);\n\t\t}\n\t}\n\ttriggerEffects(createDep(effects));\n}\n\nexport function triggerEffects(dep: Dep | ReactiveEffect[]) {\n\tconst effects = isArray(dep) ? dep : [...dep];\n\tif (effects) {\n\t\teffects.forEach(effect => {\n\t\t\t/**\n\t\t\t * effect(() => {\n\t\t\t * \t\tstate.name = 123123\n\t\t\t * })\n\t\t\t *\n\t\t\t * \u4E3A\u4E86\u9632\u6B62\u5728\u4F9D\u8D56\u4E2D\u66F4\u65B0\u54CD\u5E94\u5F0F\u6570\u636E\uFF0C\u9020\u6210\u6B7B\u5FAA\u73AF\uFF0C\u8FD9\u91CC\u8981\u505A\u5224\u65AD\uFF0C\n\t\t\t * \u5982\u679C\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684effect === \u5168\u5C40\u4E2DactiveEffect\uFF0C\u8868\u660E\u6B64effect\u6B63\u5728\u6267\u884C\n\t\t\t *\n\t\t\t */\n\t\t\tif (activeEffect !== effect) {\n\t\t\t\tif (effect.scheduler) {\n\t\t\t\t\teffect.scheduler();\n\t\t\t\t} else {\n\t\t\t\t\t// \u66F4\u65B0\u4F9D\u8D56\n\t\t\t\t\teffect.run();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * \u6E05\u7406\u4F9D\u8D56\n * @param effect \u5F53\u524D\u7684effect\n */\nexport function cleanupEffect(effect: ReactiveEffect) {\n\tconst { deps } = effect;\n\tif (deps.length) {\n\t\tfor (let index = 0; index < deps.length; index++) {\n\t\t\tdeps[index].delete(effect);\n\t\t}\n\t\tdeps.length = 0;\n\t}\n}\n", "import { hasChanged, isObject } from '@vue/shared';\nimport { track, trigger } from './effect';\nimport { ReactiveFlags, reactive } from './reactive';\n\nexport const mutableHandlers: ProxyHandler<object> = {\n\tset(target, key, newValue, receiver) {\n\t\tconst oldValue = target[key];\n\t\t// Reflect\u53CD\u5C04 \u5904\u7406\u4E86this\u6307\u5411\u95EE\u9898\n\t\tconst result = Reflect.set(target, key, newValue, receiver);\n\n\t\t// \u65B0\u503C\u8001\u503C\u4E0D\u76F8\u7B49\uFF0C\u89E6\u53D1\u4F9D\u8D56\u66F4\u65B0\n\t\tif (hasChanged(newValue, oldValue)) {\n\t\t\t// \u89E6\u53D1\u66F4\u65B0\n\t\t\ttrigger(target, key, newValue, oldValue);\n\t\t}\n\n\t\treturn result;\n\t},\n\tget(target, key, receiver) {\n\t\tif (key === ReactiveFlags.IS_REACTIVE) {\n\t\t\t// \u8FD9\u91CC\u8868\u660Etarget\u662F\u4EE3\u7406\u5BF9\u8C61\n\t\t\treturn true;\n\t\t}\n\n\t\t// \u4F9D\u8D56\u6536\u96C6\n\t\ttrack(target, key);\n\n\t\tconst res = Reflect.get(target, key, receiver);\n\n\t\t// \u5904\u7406\u6DF1\u5C42\u6B21\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u5982\u679C\u8FD4\u56DE\u503C\u662F\u5BF9\u8C61\uFF0C\u9700\u8981\u518D\u5BF9 \u5BF9\u8C61 \u505A\u4E00\u6B21\u4EE3\u7406\n\t\tif (isObject(res)) {\n\t\t\treturn reactive(res);\n\t\t}\n\n\t\treturn res;\n\t}\n};\n", "import { isObject } from '@vue/shared';\nimport { mutableHandlers } from './baseHandlers';\n\nexport const enum ReactiveFlags {\n\tSKIP = '__v_skip',\n\tIS_REACTIVE = '__v_isReactive',\n\tIS_READONLY = '__v_isReadonly',\n\tIS_SHALLOW = '__v_isShallow',\n\tRAW = '__v_raw'\n}\n\nexport interface Target {\n\t[ReactiveFlags.SKIP]?: boolean;\n\t[ReactiveFlags.IS_REACTIVE]?: boolean;\n\t[ReactiveFlags.IS_READONLY]?: boolean;\n\t[ReactiveFlags.IS_SHALLOW]?: boolean;\n\t[ReactiveFlags.RAW]?: any;\n}\n\nexport const reactiveMap = new WeakMap<Target, any>();\n\nexport const isReactive = (value: unknown) => {\n\treturn !!(value && (value as Target)[ReactiveFlags.IS_REACTIVE]);\n};\n\nexport function reactive(target: object) {\n\tif (!isObject(target)) {\n\t\treturn target;\n\t}\n\n\t// \u5224\u65AD\u5BF9\u8C61\u662F\u5426\u88AB\u4EE3\u7406\u8FC7\uFF0C\u5982\u679C\u662F\uFF0C\u8FD4\u56DE\u4EE3\u7406\u5BF9\u8C61\n\t/** \u573A\u666F\uFF1A\n\t *  const obj = {a: 1}\n\t * \tconst state = reactive(obj);\n\t\t\tconst state2 = reactive(obj);\n\t\t\tstate === state2  true\n\t */\n\tconst existingProxy = reactiveMap.get(target);\n\tif (existingProxy) {\n\t\treturn existingProxy;\n\t}\n\n\t// \u5982\u679C\u4EE3\u7406\u5BF9\u8C61\u518D\u5305\u88C5\u6210reactive\uFF0C\u8FD9\u91CC\u53D6\u503C\u4F1A\u89E6\u53D1 proxy get\u65B9\u6CD5\n\t/** \u573A\u666F\uFF1A\n\t *  const obj = {a: 1}\n\t * \tconst state = reactive(obj);\n\t\t\tconst state2 = reactive(state);\n\t\t\tstate === state2  true\n\t */\n\tif (target[ReactiveFlags.IS_REACTIVE]) {\n\t\treturn target;\n\t}\n\n\tconst proxy = new Proxy(target, mutableHandlers);\n\n\t// \u7F13\u5B58\u4EE3\u7406\u5BF9\u8C61\n\treactiveMap.set(target, proxy);\n\treturn proxy;\n}\n", "import { NOOP, isFunction } from '@vue/shared';\nimport { ReactiveEffect, activeEffect, trackEffects, triggerEffects } from './effect';\nimport { Dep } from './dep';\n\nexport interface ComputedRef<T = any> extends WritableComputedRef<T> {\n\treadonly value: T;\n}\n\nexport interface WritableComputedRef<T> {\n\treadonly effect: ReactiveEffect<T>;\n}\n\nexport interface WritableComputedOptions<T> {\n\tget: ComputedGetter<T>;\n\tset: ComputedSetter<T>;\n}\n\nexport type ComputedGetter<T> = (...args: any[]) => T;\nexport type ComputedSetter<T> = (v: T) => void;\n\nclass ComputedRefImpl<T> {\n\t// \u6536\u96C6\u5F53\u524D\u7684effect\uFF0C \u4F5C\u7528\uFF1A\u5F53\u6539\u53D8\u8BA1\u7B97\u5C5E\u6027\u7684\u503C\uFF0C\u4E5F\u8981\u89E6\u53D1effect\u4F9D\u8D56\u66F4\u65B0\n\tpublic dep: Dep = undefined;\n\n\t// \u5185\u90E8\u7F13\u5B58\u8BA1\u7B97\u8FC7\u540E\u7684\u503C\n\tprivate _value: T = undefined;\n\n\t// \u6807\u8BB0\u5F53\u524D\u662F\u5426\u88AB\u7F13\u5B58\u8FC7\uFF1A\u5982\u679C\u662Ftrue\uFF0C\u8868\u660E\u6CA1\u6709\u7528\u8FC7\uFF0C \u9700\u8981\u6267\u884Ceffect\u7684run\uFF0Cfalse\u8868\u660E\u7528\u8FC7\u4E86\uFF0C\u53D6_value\u7F13\u5B58\u7684\u503C\n\tpublic _dirty = true;\n\n\t// \u6536\u96C6\u4F9D\u8D56\n\tpublic readonly effect: ReactiveEffect<T>;\n\n\tconstructor(public getter: ComputedGetter<T>, private readonly _setter: ComputedSetter<T>) {\n\t\t// \u8FD9\u91CC\u7684 ReactiveEffect\u7B2C\u4E8C\u4E2A\u56DE\u8C03\u89E6\u53D1\u65F6\u673A\uFF1A\u5F53proxy\u5BF9\u8C61\u5C5E\u6027\u89E6\u53D1\u4E86set\n\t\t// getter\u91CC\u9762\u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027 \u6536\u96C6\u5F53\u524D\u5185\u90E8\u7684effect\n\n\t\t/**\n\t\t * @example\n\t\t * computed(() => {\n\t\t * \t\treturn state.name + state.name2\n\t\t * })\n\t\t *\n\t\t * \u8FD9\u91CC\u7684name \u548C name2 \u90FD\u6536\u96C6\u4E86 this.effect\n\t\t * \u6B64\u65F6\u7684 weakMap\u7ED3\u6784\u5982\u4E0B\uFF1A { target: Map{name: Set<this.effect>, name2: Set<this.effect>} }\n\t\t */\n\t\tthis.effect = new ReactiveEffect(getter, () => {\n\t\t\t// \u8FD9\u91CC\u8BF4\u660E\u6709\u65B0\u7684\u4F9D\u8D56\u503C\u6709\u53D8\u5316\uFF0C\u91CD\u7F6E\u810F\u68C0\u67E5\n\t\t\tif (!this._dirty) {\n\t\t\t\tthis._dirty = true;\n\t\t\t\t// \u89E6\u53D1\u6536\u96C6\u7684effect\n\t\t\t\ttriggerEffects(this.dep);\n\t\t\t}\n\t\t});\n\t}\n\n\t// \u5BF9\u8BA1\u7B97\u5C5E\u6027\u53D6\u503C\n\t/**\n\t * @example\n\t * ```js\n\t * const fullName = computed(() => state.firstName + state.secoedName)\n\t * ```\n\t *\n\t * ```html\n\t * <template>{{fullName}}</template>\n\t * ```\n\t */\n\tget value() {\n\t\tif (activeEffect) {\n\t\t\t// \u5982\u679C\u6709activeEffect\uFF0C\u8BF4\u660E\u8FD9\u4E2A\u8BA1\u7B97\u5C5E\u6027\u5728effect\u4E2D\u4F7F\u7528\uFF0C\u8BA1\u7B97\u5C5E\u6027\u9700\u8981\u6536\u96C6\u8FD9\u4E2Aeffect\n\t\t\ttrackEffects(this.dep || (this.dep = new Set<ReactiveEffect>()));\n\t\t}\n\n\t\t// \u5982\u679C\u662F\u810F\u7684\uFF0C\u8868\u660E\u6CA1\u6709\u7528\u8FC7\uFF0C\u9700\u8981\u6267\u884Ceffect\u83B7\u53D6\u65B0\u7684\u503C\n\t\tif (this._dirty) {\n\t\t\t// \u6807\u8BB0\u4E3A\u7528\u8FC7\n\t\t\tthis._dirty = false;\n\t\t\tthis._value = this.effect.run();\n\t\t}\n\t\t// \u8BFB\u53D6\u7F13\u5B58\u7684\u503C\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * @example\n\t * ```js\n\t * const fullName = computed(() => state.firstName + state.secoedName)\n\t * fullName.value = 'mini vue3'\n\t * \u5BF9\u8BA1\u7B97\u5C5E\u6027\u8D4B\u503C\uFF0C\u4E5F\u4F1A\u89E6\u53D1\u9875\u9762\u66F4\u65B0\n\t * ```\n\t */\n\tset value(newValue: T) {\n\t\tthis._setter(newValue);\n\t}\n}\n\nexport function computed<T>(getter: ComputedGetter<T>): ComputedRef<T>;\nexport function computed<T>(options: WritableComputedOptions<T>): WritableComputedRef<T>;\nexport function computed<T>(getterOrOptions: ComputedGetter<T> | WritableComputedOptions<T>) {\n\tlet setter: ComputedSetter<T>;\n\tlet getter: ComputedGetter<T>;\n\tconst onlyGetter = isFunction(getterOrOptions);\n\tif (onlyGetter) {\n\t\tgetter = getterOrOptions;\n\t\tsetter = NOOP;\n\t} else {\n\t\tsetter = getterOrOptions.set || NOOP;\n\t\tgetter = getterOrOptions.get;\n\t}\n\n\treturn new ComputedRefImpl(getter, setter);\n}\n", "import { NOOP, isArray, isFunction, isObject, isPlainObject } from '@vue/shared';\nimport { ComputedRef } from './computed';\nimport { ReactiveEffect } from './effect';\nimport { isReactive } from './reactive';\n\nexport interface WatchOptions<Immediate = boolean> {\n\timmediate?: Immediate;\n\tdeep?: boolean;\n}\n\nexport type WatchEffect = (onCleanup: OnCleanup) => void;\n\n// () => T\uFF1A getter\n// ComputedRef: \u8BA1\u7B97\u5C5E\u6027\n// Ref<T> ref\n// \u54CD\u5E94\u5F0F\u5BF9\u8C61\nexport type WatchSource<T = any> = ComputedRef<T> | (() => T);\n\ntype OnCleanup = (cleanupFn: () => void) => void;\n\nexport type WatchCallback<V = any, OV = any> = (value: V, oldValue: OV, onCleanup?: OnCleanup) => any;\n\n// watch \u53EF\u4EE5\u76D1\u542C ref\u3001 computed\u3001 reactive\u3001getter\n// \u5F53\u76D1\u542C\u6574\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61reactive\u65F6\uFF0C\u4F1A\u81EA\u52A8\u542F\u7528\u6DF1\u5C42\u6A21\u5F0F\uFF0C \u9012\u5F52\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u89E6\u53D1\u6BCF\u4E2A\u5C5E\u6027\u6536\u96C6effect\uFF0C\u6240\u4EE5\u4E0D\u5EFA\u8BAE\u76F4\u63A5\u76D1\u542C\u6574\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u4F1A\u6709\u9690\u5F62\u7684\u6027\u80FD\u5F71\u54CD\n// \u63A8\u8350\u4F7F\u7528getter \u65B9\u6CD5 \u8BBF\u95EE\u6BCF\u4E2A\u5C5E\u6027\uFF1A watch(() => state.name, cb)\nexport function watch<T = any, Immediate extends Readonly<boolean> = false>(\n\tsource: T | WatchSource<T>,\n\tcb: WatchCallback,\n\toptions?: WatchOptions<Immediate>\n) {\n\tdoWatch(source as any, cb, options);\n}\n\n// TODO: 1\uFF1A\u505C\u6B62\u4FA6\u542C\u5668  2\uFF1A\u526F\u4F5C\u7528\u6E05\u7406 3\uFF1A\u76D1\u542C\u6570\u7EC4\u7ED3\u6784\nfunction doWatch(\n\tsource: WatchSource | WatchSource[] | WatchEffect | object,\n\tcb: WatchCallback | null,\n\t{ immediate, deep }: WatchOptions = {}\n) {\n\tlet getter: () => any;\n\tif (isReactive(source)) {\n\t\t/**\n\t\t * @example\n\t\t * const state = reactive({name : 1})\n\t\t * watch(state, val => {})\n\t\t */\n\t\t// \u9012\u5F52\u904D\u5386\u5BF9\u8C61\uFF0C\u4F9D\u6B21\u53D6\u503C\uFF0C\u5C5E\u6027\u5C31\u4F1A\u6536\u96C6\u5185\u90E8\u7684effect\n\t\tgetter = () => traverse(source);\n\t\t// \u5F53\u76F4\u63A5\u4FA6\u542C\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\u65F6\uFF0C\u4FA6\u542C\u5668\u4F1A\u81EA\u52A8\u542F\u7528\u6DF1\u5C42\u6A21\u5F0F\n\t\tdeep = true;\n\t} else if (isFunction(source)) {\n\t\t/**\n\t\t * @example\n\t\t * const state = reactive({name : 1})\n\t\t * watch(() => state.name, val => {})\n\t\t */\n\t\t// \u76F4\u63A5\u53D6\u503C\n\t\tgetter = source as any;\n\t} else {\n\t\tgetter = NOOP;\n\t}\n\n\t// \u521D\u59CB\u5316undefined\uFF0C\u7B2C\u4E00\u6B21\u89E6\u53D1watch\u56DE\u8C03\uFF0ColdValue \u662F\u6CA1\u6709\u7684\n\tlet oldValue = undefined;\n\n\t// scheduler\n\tconst job = () => {\n\t\tif (!effect.active) {\n\t\t\treturn;\n\t\t}\n\t\tif (cb) {\n\t\t\t// \u6267\u884Cgetter\u65B9\u6CD5\uFF0C\u62FF\u5230\u6700\u65B0\u7684\u8FD4\u56DE\u503C\n\t\t\tconst newValue = effect.run();\n\t\t\t// \u4F20\u7ED9watch\u56DE\u8C03\n\t\t\tcb(newValue, oldValue);\n\t\t\t// \u66F4\u65B0\u8001\u503C\n\t\t\toldValue = newValue;\n\t\t} else {\n\t\t\t// watchEffect\n\t\t\teffect.run();\n\t\t}\n\t};\n\n\t// getter \u65B9\u6CD5\u91CC\u9762\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027\u6536\u96C6\u4E86\u8FD9\u4E2Aeffect\uFF0C\u5F53\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027\u53D1\u751Fset\uFF0C\u5C31\u4F1A\u89E6\u53D1\u8FD9\u91CC\u7684job\u65B9\u6CD5\uFF0C\n\t// job\u65B9\u6CD5\u91CC\u9762\u6267\u884Cgetter\u65B9\u6CD5\uFF0C\u62FF\u5230\u6700\u65B0\u7684\u503C\uFF0C\u7136\u540E\u5C06\u8001\u503C\uFF0C\u65B0\u503C\u629B\u51FAcb\uFF0C\u7528\u6237\u5C31\u80FD\u62FF\u5230\u65E7 \u65B0 \u503C\n\tconst effect = new ReactiveEffect(getter, job);\n\n\tif (cb) {\n\t\tif (immediate) {\n\t\t\t// \u7ACB\u5373\u89E6\u53D1\n\t\t\tjob();\n\t\t} else {\n\t\t\t// \u5982\u679C\u7528\u6237\u6CA1\u6709\u5199immediate\uFF0C\u4E3B\u52A8\u89E6\u53D1\uFF0C\n\t\t\t// \u8FD9\u91CC\u7A0B\u5E8F\u8981\u4E3B\u52A8\u89E6\u53D1getter\u62FF\u5230\u8001\u503C\uFF0C\u540C\u65F6\u56E0\u4E3A\u6709\u5C5E\u6027\u8BBF\u95EE\uFF0C\u89E6\u53D1\u5F53\u524D\u76D1\u542C\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5C5E\u6027\u4F9D\u8D56\u6536\u96C6effect\uFF0C\u5F53\u5C5E\u6027\u53D8\u5316\u65F6\uFF0C\u89E6\u53D1\u4F9D\u8D56effect\u66F4\u65B0, \u62FF\u5230\u65B0\u503C\n\t\t\toldValue = effect.run();\n\t\t}\n\t} else {\n\t\t// watchEffect\n\t\teffect.run();\n\t}\n}\n\nexport function traverse(value: unknown, seen?: Set<unknown>) {\n\tif (!isObject(value)) {\n\t\treturn value;\n\t}\n\tseen = seen || new Set();\n\tif (seen.has(value)) {\n\t\treturn value;\n\t}\n\tseen.add(value);\n\tif (isArray(value)) {\n\t\tfor (let index = 0; index < value.length; index++) {\n\t\t\ttraverse(value[index], seen);\n\t\t}\n\t} else if (isPlainObject(value)) {\n\t\tfor (const key in value) {\n\t\t\ttraverse(value[key], seen);\n\t\t}\n\t}\n\treturn value;\n}\n"],
  "mappings": "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",
  "names": ["effect", "ReactiveFlags", "effect"]
}
